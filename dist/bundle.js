(()=>{const t=Math.PI/180,e=document.getElementById("canvas"),i=e.getContext("2d");e.tabIndex=1,e.addEventListener("click",(()=>{switch(a.curr){case a.getReady:a.curr=a.Play,r.start.play();break;case a.Play:n.flap();break;case a.gameOver:a.curr=a.getReady,n.speed=0,n.y=100,o.pipes=[],d.score.curr=0,r.played=!1}})),e.onkeydown=function(t){if(32==t.keyCode||87==t.keyCode||38==t.keyCode)switch(a.curr){case a.getReady:a.curr=a.Play,r.start.play();break;case a.Play:n.flap();break;case a.gameOver:a.curr=a.getReady,n.speed=0,n.y=100,o.pipes=[],d.score.curr=0,r.played=!1}};let s=0;const a={curr:0,getReady:0,Play:1,gameOver:2},r={start:new Audio,flap:new Audio,score:new Audio,hit:new Audio,die:new Audio,played:!1},h={sprite:new Image,x:0,y:0,draw:function(){this.y=parseFloat(e.height-this.sprite.height),i.drawImage(this.sprite,this.x,this.y)},update:function(){a.curr==a.Play&&(this.x-=2,this.x=this.x%(this.sprite.width/2))}},p={sprite:new Image,x:0,y:0,draw:function(){y=parseFloat(e.height-this.sprite.height),i.drawImage(this.sprite,this.x,y)}},o={top:{sprite:new Image},bot:{sprite:new Image},gap:85,moved:!0,pipes:[],draw:function(){for(let t=0;t<this.pipes.length;t++){let e=this.pipes[t];i.drawImage(this.top.sprite,e.x,e.y),i.drawImage(this.bot.sprite,e.x,e.y+parseFloat(this.top.sprite.height)+this.gap)}},update:function(){a.curr==a.Play&&(s%100==0&&this.pipes.push({x:parseFloat(e.width),y:-210*Math.min(Math.random()+1,1.8)}),this.pipes.forEach((t=>{t.x-=2})),this.pipes.length&&this.pipes[0].x<-this.top.sprite.width&&(this.pipes.shift(),this.moved=!0))}},n={animations:[{sprite:new Image},{sprite:new Image},{sprite:new Image},{sprite:new Image}],rotatation:0,x:50,y:100,speed:0,gravity:.125,thrust:3.6,frame:0,draw:function(){let e=this.animations[this.frame].sprite.height,s=this.animations[this.frame].sprite.width;i.save(),i.translate(this.x,this.y),i.rotate(this.rotatation*t),i.drawImage(this.animations[this.frame].sprite,-s/2,-e/2),i.restore()},update:function(){let e=parseFloat(this.animations[0].sprite.width)/2;switch(a.curr){case a.getReady:this.rotatation=0,this.y+=s%10==0?Math.sin(s*t):0,this.frame+=s%10==0?1:0;break;case a.Play:this.frame+=s%5==0?1:0,this.y+=this.speed,this.setRotation(),this.speed+=this.gravity,(this.y+e>=h.y||this.collisioned())&&(a.curr=a.gameOver);break;case a.gameOver:this.frame=1,this.y+e<h.y?(this.y+=this.speed,this.setRotation(),this.speed+=2*this.gravity):(this.speed=0,this.y=h.y-e,this.rotatation=90,r.played||(r.die.play(),r.played=!0))}this.frame=this.frame%this.animations.length},flap:function(){this.y>0&&(r.flap.play(),this.speed=-this.thrust)},setRotation:function(){this.speed<=0?this.rotatation=Math.max(-25,-25*this.speed/(-1*this.thrust)):this.speed>0&&(this.rotatation=Math.min(90,90*this.speed/(2*this.thrust)))},collisioned:function(){if(!o.pipes.length)return;let t=this.animations[0].sprite,e=o.pipes[0].x,i=o.pipes[0].y,s=t.height/4+t.width/4,a=i+parseFloat(o.top.sprite.height),h=a+o.gap,p=parseFloat(o.top.sprite.width);if(this.x+s>=e)if(this.x+s<e+p){if(this.y-s<=a||this.y+s>=h)return r.hit.play(),!0}else o.moved&&(d.score.curr++,r.score.play(),o.moved=!1)}},d={getReady:{sprite:new Image},gameOver:{sprite:new Image},tap:[{sprite:new Image},{sprite:new Image}],score:{curr:0,best:0},x:0,y:0,tx:0,ty:0,frame:0,draw:function(){switch(a.curr){case a.getReady:this.y=parseFloat(e.height-this.getReady.sprite.height)/2,this.x=parseFloat(e.width-this.getReady.sprite.width)/2,this.tx=parseFloat(e.width-this.tap[0].sprite.width)/2,this.ty=this.y+this.getReady.sprite.height-this.tap[0].sprite.height,i.drawImage(this.getReady.sprite,this.x,this.y),i.drawImage(this.tap[this.frame].sprite,this.tx,this.ty);break;case a.gameOver:this.y=parseFloat(e.height-this.gameOver.sprite.height)/2,this.x=parseFloat(e.width-this.gameOver.sprite.width)/2,this.tx=parseFloat(e.width-this.tap[0].sprite.width)/2,this.ty=this.y+this.gameOver.sprite.height-this.tap[0].sprite.height,i.drawImage(this.gameOver.sprite,this.x,this.y),i.drawImage(this.tap[this.frame].sprite,this.tx,this.ty)}this.drawScore()},drawScore:function(){switch(i.fillStyle="#FFFFFF",i.strokeStyle="#000000",a.curr){case a.Play:i.lineWidth="2",i.font="35px Squada One",i.fillText(this.score.curr,e.width/2-5,50),i.strokeText(this.score.curr,e.width/2-5,50);break;case a.gameOver:i.lineWidth="2",i.font="40px Squada One";let t=`SCORE :     ${this.score.curr}`;try{this.score.best=Math.max(this.score.curr,localStorage.getItem("best")),localStorage.setItem("best",this.score.best);let s=`BEST  :     ${this.score.best}`;i.fillText(t,e.width/2-80,e.height/2+0),i.strokeText(t,e.width/2-80,e.height/2+0),i.fillText(s,e.width/2-80,e.height/2+30),i.strokeText(s,e.width/2-80,e.height/2+30)}catch(s){i.fillText(t,e.width/2-85,e.height/2+15),i.strokeText(t,e.width/2-85,e.height/2+15)}}},update:function(){a.curr!=a.Play&&(this.frame+=s%10==0?1:0,this.frame=this.frame%this.tap.length)}};h.sprite.src="img/ground.png",p.sprite.src="img/BG.png",o.top.sprite.src="img/toppipe.png",o.bot.sprite.src="img/botpipe.png",d.gameOver.sprite.src="img/go.png",d.getReady.sprite.src="img/getready.png",d.tap[0].sprite.src="img/tap/t0.png",d.tap[1].sprite.src="img/tap/t1.png",n.animations[0].sprite.src="img/bird/b0.png",n.animations[1].sprite.src="img/bird/b1.png",n.animations[2].sprite.src="img/bird/b2.png",n.animations[3].sprite.src="img/bird/b0.png",r.start.src="sfx/start.wav",r.flap.src="sfx/flap.wav",r.score.src="sfx/score.wav",r.hit.src="sfx/hit.wav",r.die.src="sfx/die.wav",setInterval((function(){n.update(),h.update(),o.update(),d.update(),i.fillStyle="#30c0df",i.fillRect(0,0,e.width,e.height),p.draw(),o.draw(),n.draw(),h.draw(),d.draw(),s++}),20)})();